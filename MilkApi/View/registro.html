<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Registros por Vaca</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" />
  <link rel="stylesheet" type="text/css"
    href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" />
  <link rel="stylesheet" type="text/css"
    href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css" />
</head>

<style>
  .manejo {
    color: #3366FF;
  }

  .reproducao {
    color: #B84DFF;
  }

  .prenhez {
    color: #FF4D4D;
  }

  .suplemento {
    color: #FFD14D;
  }

  .lote {
    color: #ff4492;
  }

  .qualidade {
    color: #FF944D;
  }
</style>

<body>
  <nav>
    <div class="nav1">
      <div class="logo">Cownt</div>
      <div class="menu">
        <a href="dashboard.html"><i class="ph-bold ph-house-line"></i> Dashboard</a>
        <a href="estatisticas.html"><i class="ph-bold ph-chart-line"></i> Estatísticas</a>
        <a href="addgado.html" ><i class="ph ph-cow"></i> Gerenciar Gados</a>
        <a href="registro.html" class="active"><i class="ph ph-cow"></i> Registros</a>
        <a href="ocorrenciadiaria.html"><i class="ph-bold ph-calendar-dots"></i> Ocorrências Diárias</a>
        <div class="user-menu">
          <div class="user-avatar" onclick="toggleDropdown()"><i class="ph ph-user-circle"></i></div>
          <div class="dropdown" id="dropdownMenu">
            <a class="drop-menu" href="perfil.html"><i class="ph-bold ph-user"></i> Editar Perfil</a>
            <a class="drop-menu" href="#" onclick="logout()"><i class="ph-bold ph-sign-out"></i> Sair da Conta</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <content>
    <h1>Registros por Vaca</h1>
    <div id="listaVacas"></div>
  </content>

  <script src="app.js"></script>
  <script>
    async function carregarVacas() {
      // Defina o usuário fixo para teste
      const usuarioId = localStorage.getItem("userId");

      try {
        const resp = await fetch(`https://localhost:7092/Vaca/ResumoUsuario/${usuarioId}`);
        const vacas = await resp.json();

        console.log("Dados recebidos da API:", vacas); // debug

        const container = document.getElementById("listaVacas");
        container.innerHTML = "";

        if (!vacas || vacas.length === 0) {
          container.innerHTML = "<p>Nenhuma vaca encontrada.</p>";
          return;
        }

        vacas.forEach(vaca => {
          const card = document.createElement("div");
          card.className = "card";

          const icones = [];
          if (vaca.temLeite) icones.push(`<span class="leite"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4DA6FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-milk-icon lucide-milk"><path d="M8 2h8"/><path d="M9 2v2.789a4 4 0 0 1-.672 2.219l-.656.984A4 4 0 0 0 7 10.212V20a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-9.789a4 4 0 0 0-.672-2.219l-.656-.984A4 4 0 0 1 15 4.788V2"/><path d="M7 15a6.472 6.472 0 0 1 5 0 6.47 6.47 0 0 0 5 0"/></svg></span>`);
          if (vaca.temManejo) icones.push(`<span class="manejo"><i class="ph ph-cow"></i></span>`);
          if (vaca.temPrenhez) icones.push(`<span class="prenhez"><i class="ph ph-first-aid"></i></span>`);
          if (vaca.temRemedio) icones.push(`<span class="remedio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#14ca66" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-syringe-icon lucide-syringe"><path d="m18 2 4 4"/><path d="m17 7 3-3"/><path d="M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5"/><path d="m9 11 4 4"/><path d="m5 19-3 3"/><path d="m14 4 6 6"/></svg></span>`);
          if (vaca.temReproducao) icones.push(`<span class="reproducao"><i class="ph ph-heartbeat"></i></span>`);
          if (vaca.temSuplemento) icones.push(`<span class="suplemento"><i class="ph ph-pill"></i></span>`);
          if (vaca.temLote) icones.push(`<span class="lote"><i class="ph ph-package"></i></span>`);
          if (vaca.temQualidade) icones.push(`<span class="qualidade"><i class="ph ph-drop"></i></span>`); // ✅ ícone de Qualidade adicionado

          card.innerHTML = `
            <div class="setinha">
            <h3 class="brinco">Brinco: ${vaca.brinco} <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right h-5 w-5 text-muted-foreground" data-lov-id="src/pages/Registros.tsx:204:20" data-lov-name="ChevronRight" data-component-path="src/pages/Registros.tsx" data-component-line="204" data-component-file="Registros.tsx" data-component-name="ChevronRight" data-component-content="%7B%22className%22%3A%22h-5%20w-5%20text-muted-foreground%22%7D"><path d="m9 18 6-6-6-6"></path></svg></h3></div>
            <p>Raça: ${vaca.raca}</p>
            <div class="iconregistro">
            <p>${vaca.totalRegistros} registros</p>
            <div class="icones">${icones.join(' ')}</div>
            </div>
        `;

          card.onclick = () => {
            localStorage.setItem("vacaSelecionada", vaca.id);
            window.location.href = "detalhes.html";
          };

          container.appendChild(card);
        });

      } catch (err) {
        console.error("Erro ao carregar vacas:", err);
        document.getElementById("listaVacas").innerHTML = "<p>Erro ao carregar vacas.</p>";
      }
    }

    window.onload = carregarVacas;
  </script>
</body>

</html>