<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Login e Cadastro</title>
    <link rel="icon" href="img/gado_inicio_escuro_png1.png">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Noto Sans", sans-serif;
            background-color: #F5EBE0;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            height: 100vh;
        }


        .container {
            background: #f8f2ec;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            width: 350px;
            margin-right: 10%;
        }

        h1 {
            font-family: "Ultra", serif;
            text-align: center;
        }

        h2 {
            text-align: center;
            color: #563c29;
        }

        .tabs {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            background-color: #81593e;
            border: #81593e, 5px solid;
            border-radius: 50px;
            color: #F5EBE0;
        }

        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: bold;
            transition: 0.3s;
        }

            .tab.active {
                background-color: #563c29;
                border-radius: 50px;
            }

        input {
            font-family: "Noto Sans", sans-serif;
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            max-width: 94%;
            background-color: #F5EBE0;
        }

        button {
            font-family: "Noto Sans", sans-serif;
            width: 100%;
            padding: 10px;
            background-color: #563c29;
            color: #F5EBE0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.4s;
            margin-top: 10px;
        }

            button:hover {
                background-color: #81593e;
            }
    </style>
</head>
<body>
    <div class="img-login">
      
    </div>
    
    <div class="container">
        <h1>COWNT</h1>
      <h2 id="formTitle"></h2>

      <div class="tabs">
        <div class="tab active" onclick="mostrarAba('login')">Entrar</div>
        <div class="tab" onclick="mostrarAba('cadastro')">Cadastrar</div>
      </div>

      <div id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginSenha" placeholder="Senha" required>
        <button onclick="login()">Entrar</button>
      </div>

      <div id="cadastroForm" style="display: none;">
        <input type="text" id="cadNome" placeholder="Nome" required>
        <input type="email" id="cadEmail" placeholder="Email" required>
        <input type="password" id="cadSenha" placeholder="Senha" required>
        <input type="password" id="cadConfSenha" placeholder="Confirme sua senha" required>
        <input type="date" id="cadDataNasc" required>
        <input type="text" id="cadCPF" placeholder="CPF" required>
        <button onclick="cadastrar()">Cadastrar</button>
      </div>
    </div>
  

  <script>
    const apiUrl = "https://localhost:7092/Usuario"; 

    function mostrarAba(aba) {
      const loginForm = document.getElementById("loginForm");
      const cadastroForm = document.getElementById("cadastroForm");
      const formTitle = document.getElementById("formTitle");
      const tabs = document.querySelectorAll(".tab");

      tabs.forEach(tab => tab.classList.remove("active"));

      if (aba === "login") {
        loginForm.style.display = "block";
        cadastroForm.style.display = "none";
        formTitle.textContent = "";
        tabs[0].classList.add("active");
      } else {
        loginForm.style.display = "none";
        cadastroForm.style.display = "block";
        formTitle.textContent = "";
        tabs[1].classList.add("active");
      }
    }

    async function login() {
  const email = document.getElementById("loginEmail").value;
  const senha = document.getElementById("loginSenha").value;

  try {
    const res = await fetch(apiUrl);
    const usuarios = await res.json();

    const user = usuarios.find(u => u.email === email && u.senha === senha);
    if (user) {
      alert("Login bem-sucedido! Bem-vindo, " + user.nome);
      localStorage.setItem('userId', user.id);
      

      localStorage.setItem('authenticated', 'true');
      window.location.href = 'dashboard.html';
    } else {
      alert("Email ou senha incorretos.");
    }
  } catch (err) {
    alert("Erro ao conectar com a API.");
    console.error(err);
  }
}


    document.getElementById('cadCPF').addEventListener('input', function (e) {
      let value = e.target.value.replace(/\D/g, '');
      value = value.replace(/(\d{3})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      e.target.value = value;
    });

      async function cadastrar() {
          const nome = document.getElementById("cadNome").value;
          const email = document.getElementById("cadEmail").value;
          const senha = document.getElementById("cadSenha").value;
          const confSenha = document.getElementById("cadConfSenha").value;
          const data_Nasc = document.getElementById("cadDataNasc").value;
          const cpf = document.getElementById("cadCPF").value;

          if (senha !== confSenha) {
              alert("As senhas não coincidem.");
              return;
          }

          try {
              const resGet = await fetch(apiUrl);
              const usuarios = await resGet.json();

              const emailExistente = usuarios.some(u => u.email.toLowerCase() === email.toLowerCase());
              const cpfExistente = usuarios.some(u => u.cpf === cpf);

              if (emailExistente && cpfExistente) {
                  alert("Este e-mail e CPF já estão cadastrados.");
                  return;
              } else if (emailExistente) {
                  alert("Este e-mail já está cadastrado.");
                  return;
              } else if (cpfExistente) {
                  alert("Este CPF já está cadastrado.");
                  return;
              }

              const usuario = { nome, email, senha, data_Nasc, cpf };

              const resPost = await fetch(apiUrl, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(usuario)
              });

              if (resPost.ok) {
                  alert("Usuário cadastrado com sucesso!");
                  mostrarAba("login");
              } else {
                  alert("Erro ao cadastrar usuário.");
              }

          } catch (err) {
              alert("Erro ao conectar com a API.");
              console.error(err);
          }
      }

  </script>
</body>
</html>
