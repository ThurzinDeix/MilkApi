<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Resumo do Gado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" />
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" />
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css" />
    <style>
        .manejo {
            color: #3366FF;
        }

        .reproducao {
            color: #B84DFF;
        }

        .prenhez {
            color: #FF4D4D;
        }

        .suplemento {
            color: #FFD14D;
        }

        .lote {
            color: #ff4492;
        }

        .qualidade {
            color: #FF944D;
        }

        .leite {
            color: #4DA6FF;
        }

        .remedio {
            color: #14ca66;
        }
    </style>
</head>

<body>
    <nav>
        <div class="nav1">
          <div class="logo">Cownt</div>
          <div class="menu">
            <a href="dashboard.html"><i class="ph-bold ph-house-line"></i> Dashboard</a>
            <a href="estatisticas.html"><i class="ph-bold ph-chart-line"></i> Estatísticas</a>
            <a href="addgado.html" ><i class="ph ph-cow"></i> Gerenciar Gados</a>
            <a href="registro.html" class="active"><i class="ph ph-cow"></i> Registros</a>
            <a href="ocorrenciadiaria.html"><i class="ph-bold ph-calendar-dots"></i> Ocorrências Diárias</a>
            <div class="user-menu">
              <div class="user-avatar" onclick="toggleDropdown()"><i class="ph ph-user-circle"></i></div>
              <div class="dropdown" id="dropdownMenu">
                <a class="drop-menu" href="perfil.html"><i class="ph-bold ph-user"></i> Editar Perfil</a>
                <a class="drop-menu" href="#" onclick="logout()"><i class="ph-bold ph-sign-out"></i> Sair da Conta</a>
              </div>
            </div>
          </div>
        </div>
      </nav>

    <div class="content">
        <h1 class="tit-registro">Registros por Vaca <a href="registro.html" class="btn-add">⬅ Voltar</a></h1>
        <p>Visualize todos os registros organizados por animal</p>
        <div id="infoVaca"></div>
        <div id="registrosWrapper"></div>
    </div>

    <script src="app.js"></script>
    <script>
        async function carregarDetalhes() {
    const vacaId = localStorage.getItem("vacaSelecionada");
    if (!vacaId) {
        document.getElementById("infoVaca").innerHTML = "<p>Nenhum animal selecionado.</p>";
        return;
    }

    try {
        const resp = await fetch(`https://localhost:7092/Vaca/ResumoVaca/${vacaId}`);
        const resumo = await resp.json();

        document.getElementById("infoVaca").innerHTML = `
            <p class="brinco">Brinco: ${resumo.brinco}</p>
            <p class="perfil-subtitle">Raça: ${resumo.raca}</p>
        `;

        const wrapper = document.getElementById("registrosWrapper");
        wrapper.innerHTML = "";

        function criarBloco(titulo, registros, renderItem, tipoClasse, icone) {
            const bloco = document.createElement("div");
            bloco.className = `registro-bloco ${tipoClasse}`;

            const header = document.createElement("div");
            header.className = "registro-header";
            header.innerHTML = `
                <div class="iconregistro">
                    <div class="registro-icone">${icone}</div>
                    <div class="registro-titulo">${titulo} <span class="badge-status1">${registros?.length || 0} ${registros?.length === 1 ? "registro" : "registros"}</span></div>
                </div>
                <div class="setinha"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#777" d="M7 10l5 5 5-5H7z"/></svg></div>
            `;

            const lista = document.createElement("div");
            lista.className = "registro-lista";
            lista.style.display = "none";

            if (!registros || registros.length === 0) {
                lista.innerHTML = "<p>Nenhum registro.</p>";
            } else {
                registros.forEach(item => {
                    const card = document.createElement("div");
                    card.className = "card registro-card";

                    card.innerHTML = `<div class="card-content">${renderItem(item)}</div>
                                      <div class="card-actions">
                                        <button class="btn-edit"><i class="fa-solid fa-pen-to-square"></i></button>
                                        <button class="btn-delete"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2"><path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
                                      </div>`;

                    card.querySelector(".btn-edit").addEventListener("click", () => {
                        alert(`Editar registro: ${JSON.stringify(item)}`);
                    });

                    card.querySelector(".btn-delete").addEventListener("click", async () => {
                        if (!confirm("Deseja realmente excluir este registro?")) return;

                        try {
                            let endpoint = "";
                            switch (tipoClasse) {
                                case "leite": endpoint = `Leite/${item.id}`; break;
                                case "remedio": endpoint = `Remedio/${item.id}`; break;
                                case "manejo": endpoint = `Manejo/${item.id}`; break;
                                case "prenhez": endpoint = `Prenhez/${item.id}`; break;
                                case "reproducao": endpoint = `Reproducao/${item.id}`; break;
                                case "suplemento": endpoint = `Suplemento/${item.id}`; break;
                                case "lote": endpoint = `Lote/${item.id}`; break;
                                default: alert("Tipo de registro desconhecido"); return;
                            }

                            const resp = await fetch(`https://localhost:7092/${endpoint}`, { method: "DELETE" });
                            if (resp.ok) {
                                alert("Registro excluído com sucesso!");
                                card.remove();
                            } else {
                                alert("Erro ao excluir registro.");
                            }
                        } catch (err) {
                            console.error(err);
                            alert("Erro ao excluir registro.");
                        }
                    });

                    lista.appendChild(card);
                });
            }

            header.addEventListener("click", () => {
                lista.style.display = lista.style.display === "none" ? "flex" : "none";
            });

            bloco.appendChild(header);
            bloco.appendChild(lista);
            wrapper.appendChild(bloco);
        }

        // Criar todos os blocos
        criarBloco("Produção de Leite", resumo.leites, l => `
            <p>Data: ${new Date(l.data).toLocaleDateString()}</p>
            <p>Litros: ${l.litros} L</p>
        `, "leite", `<span class="leite"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4DA6FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-milk-icon lucide-milk"><path d="M8 2h8"/><path d="M9 2v2.789a4 4 0 0 1-.672 2.219l-.656.984A4 4 0 0 0 7 10.212V20a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-9.789a4 4 0 0 0-.672-2.219l-.656-.984A4 4 0 0 1 15 4.788V2"/><path d="M7 15a6.472 6.472 0 0 1 5 0 6.47 6.47 0 0 0 5 0"/></svg>`);

        criarBloco("Medicamentos", resumo.remedios, r => `
            <p>Nome: ${r.nome}</p>
            <p>Doses: ${r.doses}</p>
            <p>Via: ${r.via}</p>
            <p>Data: ${new Date(r.date).toLocaleDateString()}</p>
        `, "remedio", `<span class="remedio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#14ca66" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-syringe-icon lucide-syringe"><path d="m18 2 4 4"/><path d="m17 7 3-3"/><path d="M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5"/><path d="m9 11 4 4"/><path d="m5 19-3 3"/><path d="m14 4 6 6"/></svg></span>`);

        criarBloco("Manejos", resumo.manejos, m => `
            <p>Tipo: ${m.tipo_Manejo}</p>
            <p>Data: ${new Date(m.data_Manejo).toLocaleDateString()}</p>
            <p>Observações: ${m.observacoes}</p>
        `, "manejo", `<span class="manejo"><i class="ph ph-cow"></i></span>`);

        criarBloco("Prenhezes", resumo.prenhezes, p => `
            <p>Data: ${new Date(p.data_Prenhez).toLocaleDateString()}</p>
            <p>Status: ${p.status}</p>
            <p>Data Esperada: ${p.data_Esperada ? new Date(p.data_Esperada).toLocaleDateString() : "-"}</p>
        `, "prenhez", `<span class="prenhez"><i class="ph ph-first-aid"></i></span>`);

        criarBloco("Reproduções", resumo.reproducoes, rep => `
            <p>Tipo: ${rep.tipo}</p>
            <p>Data: ${new Date(rep.data).toLocaleDateString()}</p>
            <p>Observação: ${rep.observacao}</p>
        `, "reproducao", `<span class="reproducao"><i class="ph ph-heartbeat"></i></span>`);

        criarBloco("Suplementos", resumo.suplementos, s => `
            <p>Tipo: ${s.tipo}</p>
            <p>Nome: ${s.nome}</p>
            <p>Data: ${new Date(s.date).toLocaleDateString()}</p>
        `, "suplemento", `<span class="suplemento"><i class="ph ph-pill"></i></span>`);

        criarBloco("Lotes e Qualidade", resumo.lotes, l => `
            <p>Lote #: ${l.num}</p>
            <p>Leite: ${l.leites.map(le => le.litros + " L").join(", ") || '-'}</p>
            <p>Qualidade:</p>
            <p>  CCS: ${l.qualidade?.ccs || '-'}</p>
            <p>  Gordura: ${l.qualidade?.gordura || '-'}</p>
            <p>  Proteína: ${l.qualidade?.proteina || '-'}</p>
        `, "lote", `<span class="lote"><i class="ph ph-stack"></i></span>`);

    } catch (err) {
        console.error(err);
        document.getElementById("registrosWrapper").innerHTML = "<p>Erro ao carregar registros.</p>";
    }
}

window.onload = carregarDetalhes;

    </script>
    

</body>

</html>